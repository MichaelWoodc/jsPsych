<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/jspsych/dist/index.browser.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych/css/jspsych.css" />
    <style>
      .flanker-stimulus {
        font-size: 500%;
      }
      .debrief-text {
        font-size: 25px;
      }
    </style>
  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      override_safe_mode:true,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
    
    // Instructions added at the beginning
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<p>Flanker Task Instructions:</p>' +
                '<p>Press LEFT ARROW if center arrow points LEFT</p>' +
                '<p>Press RIGHT ARROW if center arrow points RIGHT</p>' +
                '<p>Ignore flanking arrows. Press any key to begin.</p>'
    };
    
    var test_stimuli = [
      { stimulus: "<<<<<", data: { stim_type: 'congruent'} },
      { stimulus: ">>>>>", data: { stim_type: 'congruent'} },
      { stimulus: "<<><<", data: { stim_type: 'incongruent'} },
      { stimulus: ">><>>", data: { stim_type: 'incongruent'} }
    ];

    var test = {
      timeline: [{
        type: jsPsychHtmlKeyboardResponse,
        choices: ["ArrowLeft", "ArrowRight"],
        stimulus: jsPsych.timelineVariable('stimulus'),
        data: jsPsych.timelineVariable('data'),
        post_trial_gap: 1500,
        response_ends_trial: true,
        css_classes: ['flanker-stimulus']
      }],
      timeline_variables: test_stimuli,
      sample: {type: 'fixed-repetitions', size: 2}
    };

    var debrief = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        var congruent_rt = Math.round(jsPsych.data.get()
          .filter({stim_type: 'congruent'}).select('rt').mean());
        var incongruent_rt = Math.round(jsPsych.data.get().filter({stim_type: 'incongruent'}).select('rt').mean());
        return "<p>Your average response time for congruent trials was <strong>" + congruent_rt + "ms</strong>.</p>"+
        "<p>Your average response time for incongruent trials was <strong>" + incongruent_rt + "ms</strong>.</p>";
      },
      css_classes: ['debrief-text']
    };

    var timeline = [];
    timeline.push(welcome);  // Added instructions first
    timeline.push(test);
    timeline.push(debrief);

    jsPsych.run(timeline);

  </script>
</html>